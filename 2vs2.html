<!DOCTYPE html>
<html lang="th">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ระบบของANsentueng</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" ></script>

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

	<script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-FDWYWZENM1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-FDWYWZENM1');
	</script>


	<script src="js/promptpay-qr.js"></script>
	<script src="js/qrcode.min.js"></script>
	<style type="text/css">
		html, body{
			font-family: "Prompt", serif !important;
			background-color: #f5f5fa;
			
		}
		.selected{
			color: #052c65;
			background-color: #cfe2ff;
			text-decoration: underline;
			font-weight: bold;
		}
		.feenow{
			color: #198754;
		}
		.totalgame{
			color: #0d6efd;
		}
	</style>


</head>
<body>
	<div class="container-fluid">
		<div class="row mt-2">
			<div class="col-1 d-flex justify-content-center align-items-center">
				<img src="AN5.jpg" class="img-fluid">
			</div>
			<div class="col-3" id="cardmathnow">
				<div class="card text-primary" style="border-color: #FFCCFF;">
					<h5 class="card-header text-center" style="color:#fff; background-color: #FFCCFF; border-bottom-color: #FFCCFF;">No</h5>
					<div class="text-center" style="font-size:64px">
						<span id="mathnow">x</span>
					</div>
				</div>
			</div>
			<div class="col-8" id="6mathnow">
				<div class="row">
					<div class="col-6 pb-1" id="6mathnow1">
						<div class="card border-info text-info justify-content-center d-flex align-items-center" style="min-height:100%;">
							<div class="text-center" style="font-size:10px;">
								<span id="mathnow1"></span>
							</div>
						</div>
					</div>
					<div class="col-6 pb-1">
						<div class="card border-info text-info justify-content-center d-flex align-items-center" style="min-height:100%;">
							<div class="text-center" style="font-size:10px">
								<span id="mathnow2"></span>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-6 pb-1 pt-1" id="6mathnow2">
						<div class="card border-info text-info justify-content-center d-flex align-items-center" style="min-height:100%;">
							<div class="text-center" style="font-size:10px">
								<span id="mathnow3"></span>
							</div>
						</div>
					</div>
					<div class="col-6 pb-1 pt-1">
						<div class="card border-info text-info justify-content-center d-flex align-items-center" style="min-height:100%;">
							<div class="text-center" style="font-size:10px">
								<span id="mathnow4"></span>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-6 pt-1" id="6mathnow3">
						<div class="card border-info text-info justify-content-center d-flex align-items-center" style="min-height:100%;">
							<div class="text-center" style="font-size:10px">
								<span id="mathnow5"></span>
							</div>
						</div>
					</div>
					<div class="col-6 pt-1">
						<div class="card border-info text-info justify-content-center d-flex align-items-center" style="min-height:100%;">
							<div class="text-center" style="font-size:10px">
								<span id="mathnow6"></span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col">
				<div class="row mt-2" id="paneladdnewmember">
					<div class="col-12">	
						<div class="input-group">
							<input type="text" class="form-control" id="playerName" placeholder="ชื่อผู้เล่น" style="border-color: #0d6efd; color:#052c65;"  aria-label="Recipient's username" aria-describedby="button-addon2">
							<button class="btn btn-outline-primary" onclick="addPlayer()" id="button-addon2"><i class="fa-solid fa-user-plus"></i> เพิ่มสมาชิก</button>
						</div>
					</div>
				</div>
				<div class="row mt-2">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<div class="row">
									<div class="col-6 d-flex justify-content-left align-items-center">
										รายชื่อผู้เล่น <span id="totalplayertoday"></span>
									</div>
									<div class="col-6 d-flex justify-content-end">
										<a style="font-size:12px;" href="#" id="btnaddnewmrmber" class="btn btn-link"><i class="fa-solid fa-user-plus"></i> เพิ่มสมาชิก</a>
										<a style="font-size:12px;" href="" class="btn btn-link"><i class="fa-solid fa-arrows-rotate"></i> reload</a>
									</div>
								</div>
							</div>
							<div class="card-body" style="padding:0.25;">
								<div class="row pb-1">
									<div class="col">
										<input id="search" class="form-control" placeholder="ค้นหา..." autocomplete="off">
									</div>
								</div>
								<div class="row" style="max-height: 50vh; min-height: 50vh; overflow: auto;">
									<div class="col">

										<ul class="list-group list-group-flush" id="playerList"></ul>
									</div>
								</div>
								
							</div>
						</div>
					</div>
				</div>

				<div class="row mt-2">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<div class="row">
									<div class="col-6 d-flex justify-content-left align-items-center">
										เกมที่เล่นวันนี้
									</div>
									<div class="col-6 d-flex justify-content-end">
										<a style="font-size:12px;" href="" class="btn btn-link"><i class="fa-solid fa-arrows-rotate"></i> reload</a>
									</div>
								</div>
							</div>
							<div class="card-body" style="padding:0.25;">
								<div class="row" style="max-height: 50vh; min-height: 50vh; overflow: auto;">
									<div class="col">
										<ul class="list-group list-group-flush" id="gameList"></ul>
									</div>
								</div>
								
							</div>
						</div>
					</div>
				</div>

				

				
			</div>
		</div>
	</div>

	<script type="text/javascript">
		$("#paneladdnewmember").hide();
		$("#btnaddnewmrmber").click( async () => {
			$("#paneladdnewmember").show(200);
			$("#btnaddnewmrmber").hide(200);
		})
	</script>



	<!-- <h2>รายงานย้อนหลัง</h2>
	<ul id="reportList"></ul> -->

	<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-body" style="background-color: #1a3761; border-top-right-radius: calc(0.5rem - (1px)); border-top-left-radius: calc(0.5rem - (1px));">
					<div class="row">
						<div class="col-12">
							<div class="row justify-content-center">
								<div class="col-9 d-flex justify-content-center">
									<img src="ThaiQR.jpg" class="img-fluid">
								</div>
							</div>
							<div style="border: 1px solid #fff; background-color: #fff; border-radius: 5%;">
								<div class="row justify-content-center">
									<div class="col-9 d-flex justify-content-center" >
										<div style="padding-left: 25%; padding-right: 25%; padding-top: 10%; padding-bottom: 3%;">
											<img src="prompt-pay-logo.png" class="img-fluid">
										</div>
									</div>
								</div>
								<div id="qrcode" style="padding: 5%; text-align: center;" class="d-flex justify-content-center"></div>
								<div class="row">
									<div class="col-12 text-center">
										ยอดชำระ <b><span id="amoutnow">amoutnow</span></b> บาท
									</div>
									<div class="col-12 text-center">
										หมายเลขพร้อมเพย์ : <span id="accid">accid</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<div id="btnconfirmpay"></div>
					<button type="button" id="" class="btn btn-outline-secondary" data-bs-dismiss="modal"><i class="fa-regular fa-circle-xmark"></i> ปิด</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modaldelete" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-body" style="background-color: #CA0B00; border-top-right-radius: calc(0.5rem - (1px)); border-top-left-radius: calc(0.5rem - (1px));">
					<div class="row">
						<div class="col-12" style="color: #fff;">
							<i class="fa-regular fa-trash-can"></i> ยืนยัน ลบ คุณ <span	 id="nameplayerdelete"></span>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<div id="btnconfirmdelete"></div>
					<button type="button" id="" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal"><i class="fa-regular fa-circle-xmark"></i> ปิด</button>
				</div>
			</div>
		</div>
	</div>



	<script type="text/javascript">
		
		

		var qr_dom = document.getElementById('qrcode');

		var accid = "1100800088244";
		function render_qr(amount){

			let wh;

			if(window.innerWidth > window.innerHeight)
			{
				wh = (window.innerHeight - (window.innerHeight*40/100))
			}
			else
			{
				wh = (window.innerWidth - (window.innerWidth*50/100))
			}


			var txt = PromptPayQR.gen_text(accid, amount);

			qr_dom.innerHTML = "";
			if(txt){
				new QRCode(qr_dom, {
					text: txt,
					width: wh,
					height: wh,
					colorDark : "#000000",
					colorLight : "#ffffff",
					correctLevel : QRCode.CorrectLevel.H
				});
			}
		}
		//render_qr(id, amount);




		// console.log( $('#cardmathnow').height() , $('#cardmathnow').height()*0.96 );
		$("#6mathnow").css({
			"height":($('#cardmathnow').height()),
		});

		$("#6mathnow1").css({
			"height":($('#cardmathnow').height()/3),
		});
		$("#6mathnow2").css({
			"height":($('#cardmathnow').height()/3),
		});
		$("#6mathnow3").css({
			"height":($('#cardmathnow').height()/3),
		});
	</script>



	<!-- Firebase SDK v11.3.0 -->
	<script type="module">

		import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
		import { getDatabase, ref, set, get, query, orderByChild, equalTo, update, onValue, push, child, remove, startAt, endAt  } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";
		// ตั้งค่า Firebase
		const firebaseConfig = {
			apiKey: "AIzaSyAYOWpVDOQ7Q-fxjZx0vTS3SDetUbWTMY4",
			authDomain: "ansentueng.firebaseapp.com",
			databaseURL: "https://ansentueng-default-rtdb.asia-southeast1.firebasedatabase.app",
			projectId: "ansentueng",
			storageBucket: "ansentueng.firebasestorage.app",
			messagingSenderId: "370408378735",
			appId: "1:370408378735:web:729d1a9e4c951fd844589a",
			measurementId: "G-75E8KLKM6Z"
		};

		// เริ่มต้น Firebase
		const app		=	initializeApp(firebaseConfig);
		const db		=	getDatabase(app);

		const gang		=	`AN`;
		const FeeStart	=	80;
		const FeeGame	=	23;

		function dateymdhis(dd) {

			var dddd = new Date(dd);

			var d = dddd.getDate();
			var m = dddd.getMonth();
			var y = dddd.getFullYear();
			var h = dddd.getHours();
			var i = dddd.getMinutes();
			var s = dddd.getSeconds();
			//${d.toString().padStart(2, "0")}/${m.toString().padStart(2, "0")}/${y}
			//${s.toString().padStart(2, "0")}
			return `${h.toString().padStart(2, "0")}:${i.toString().padStart(2, "0")}`;
		}

		async function getCurrentDate() {
			const today = new Date();
			return today.toISOString().split("T")[0];
		}
		// setup gang
		async function setupGang() {
			const gangRef = ref(db, `${gang}/information/`);
			let rs = await set(gangRef, {
				FeeStart: FeeStart,
				FeeGame: FeeGame,
				description: "",
			});
		}

		// เพิ่มผู้เล่นใหม่
		async function addPlayer() {

			const date = await getCurrentDate();

			const playerName = document.getElementById("playerName").value;
			if (playerName.trim() === "") return;

			const playersCountRef = await ref(db, `${gang}/${date}/players/`);
			const playersno = await get(playersCountRef).then((snapshot) => {
				return (snapshot.size || 0) + 1;
			});


			const playersRef = ref(db, `${gang}/${date}/players/${playersno}`);

			await set(playersRef, {
				no: playersno,
				name: playerName,
				gamesPlayed: 0,
				status: 1,
				paystatus: 0
			});

			document.getElementById("playerName").value = "";

			$("#paneladdnewmember").hide(200);
			$("#btnaddnewmrmber").show(200);
		}

		// โหลดรายชื่อผู้เล่น
		async function loadPlayers() {

			const date = await getCurrentDate();

			const list		=	document.getElementById("playerList");

			const mathnowtoday 	= document.getElementById("mathnow");

			list.innerHTML	=	"";

			const gamesCountRef = await ref(db, `${gang}/${date}/games/`);
			const gamesno = await get(gamesCountRef).then((snapshot) => {
				return (snapshot.size || 0);
			});

			mathnowtoday.innerHTML = `${gamesno}`

			const gangRef 			= await ref(db, `${gang}/information`);
			const playersRef		= await ref(db, `${gang}/${date}/players`);
			const gamesRef 			= await ref(db, `${gang}/${date}/games`);
			const gangGet 			= await get(gangRef);
			const ganginfor 		= gangGet.val();

			const playersno = await get(playersRef).then((snapshot) => {
				return (snapshot.size || 0);
			});

			const gamesdata = await get(gamesRef).then((snapshot) => {
				return (snapshot.size || 0);
			});


				
					
			




			const totalplayertoday = document.getElementById("totalplayertoday");
			totalplayertoday.innerHTML = `&nbsp;( ${(playersno)} )`


			await onValue(playersRef, async (snapshot) => {
				list.innerHTML = ``; 
				snapshot.forEach( (childSnapshot) => {



					const playerId = childSnapshot.key;
					const data = childSnapshot.val();
					let FeeNow;

					if(data.gamesPlayed == 0)
					{
						FeeNow = ganginfor.FeeStart;
					}
					else
					{
						FeeNow = ganginfor.FeeStart + (ganginfor.FeeGame * data.gamesPlayed);
					}



					const playerlist = document.createElement("li");
					playerlist.classList.add("list-group-item");


					// getgameno(playerId).then((datas) => {
					// 	console.log(datas);
					// 	// let ht = `<span class="badge rounded-pill" style="background-color:#87CEFA;">${}</span>`;
					// });


					playerlist.innerHTML = `
						<div class="row">
							<div class="col-9" id="playerCanClick${playerId}" >
								<i class="fa-solid fa-circle-user" style="color:#FF99FF;"></i> 
								<span style="font-size:20px;">${data.name} </span>
								<br>
								<span style="font-size: 13px;">เกมที่เล่น: <b class="totalgame">${data.gamesPlayed}</b></span>
								
							</div>
							<div class="col-3 d-flex justify-content-end" id="menuList${playerId}"></div>
						</div>
					`;
					playerlist.setAttribute("data-id", playerId);
					playerlist.setAttribute("menu-id", playerId);
					list.appendChild(playerlist);



					//=================================================
					
					//=================================================

					const menu = document.getElementById(`menuList${playerId}`);

					menu.innerHTML = "";
					const menuitem = document.createElement("div");
					// menuitem.classList.add("d-flex");
					// menuitem.classList.add("justify-content-end");
					menuitem.innerHTML = `
						<div class="row d-flex justify-content-end">
							<a class="btn btn-outline-primary btn-sm" href="#" id="pay${playerId}">
								<i class="fa-solid fa-money-bill-1-wave"></i> ชำระเงิน
							</a>
							<br>

							<div class="d-flex justify-content-end" style="font-size: 13px;">

								ค่าบริการ:&nbsp;<b class="feenow">${FeeNow}</b>&nbsp;บาท
							</div>
						</div>
					`;
					menuitem.setAttribute("data-id", playerId);
					menuitem.setAttribute("menu-id", playerId);
					menu.appendChild(menuitem);
					//======
					// var setint  = '';
					// var holdval = 0;
					// $(`#playerCanClick${playerId}`).on('mousedown',function (e) {
					// 	clearInterval(setint);
					// 	holdval = 0;
					// 	setint = setInterval(function () {
					// 		++holdval;
					// 		if(holdval > 15)
					// 		{
					// 			const nameplayerdelete = document.getElementById(`nameplayerdelete`);
					// 			const btnconfirmdelete = document.getElementById(`btnconfirmdelete`);
					// 			btnconfirmdelete.innerHTML = `
					// 				<button type="button" id="btnpay${playerId}" onclick="confirmpay(${playerId})" class="btn btn-sm btn-outline-danger"><i class="fa-solid fa-circle-check"></i> ยืนยันลบ</button>
					// 			`;
					// 			nameplayerdelete.innerHTML = `<span style="font-size:20px;">${data.name} </span>`
					// 			// console.log('call delete')
					// 			$("#modaldelete").modal("show");
					// 		}
					// 	},50);
					// });
					// $(`#playerCanClick${playerId}`).on("mouseleave mouseup", function () {
					// 	holdval = 0;
					// 	clearInterval(setint);
					// });
					//======

					$(`#playerCanClick${playerId}`).click( async (e) => {
						
						playerlist.classList.toggle("selected");
						console.log(e);
						//playerlist.classList.add("selected");
						await selectPlayer(playerId, data.name);


						
					});
					$(`#pay${playerId}`).click( async (e) => {
						await render_qr(`${FeeNow}`);
						const amoutnow = document.getElementById(`amoutnow`);
						const accidshow = document.getElementById(`accid`);
						const btnconfirmpay = document.getElementById(`btnconfirmpay`);

						amoutnow.innerHTML = `${FeeNow}`;
						accidshow.innerHTML = `${accid}`;
						btnconfirmpay.innerHTML = `
							<button type="button" id="btnpay${playerId}" onclick="confirmpay(${playerId})" class="btn btn-outline-success"><i class="fa-solid fa-circle-check"></i> ชำระเรียบร้อย</button>
						`;

						$("#staticBackdrop").modal("show");
					});
				});
			});
		}

		$("#search").keyup(function(e) {
			searchplayer(this.value);
		});




		async function getgameno(playerId){
			
			const date = await getCurrentDate();
			const gamesRef 	= await ref(db, `${gang}/${date}/games`);

			const gameno = [];

			await onValue(gamesRef, async (raw) => {
				raw.forEach( (datas) => {
					const data = datas.val();

					if(
						playerId == data.team1_id1 || 
						playerId == data.team1_id2 || 
						playerId == data.team2_id1 || 
						playerId == data.team2_id2
						)
					{
						gameno[data.gameno]=playerId;
					}
				})
			});
			return gameno;
			//console.log(gameno);
			//return ``;
			
		}


		async function searchplayer(s) {


			const list = document.getElementById("playerList");
			
			list.innerHTML = "";


			const playerRef = await ref(db, `${gang}/${date}/players/`);
			const gangGet 	= await get(gangRef);
			const gangRef 	= await ref(db, `${gang}/information`);

			let ganginfor = gangGet.val();

			const q = query(playerRef, orderByChild("name"), startAt(`${s}`), endAt(`${s}\uf8ff`));


			let searchdata = await get(q).then((snapshot) => {
				if (snapshot.exists()) {
					snapshot.forEach((childSnapshot) => {

						const playerId = childSnapshot.key;
						const data = childSnapshot.val();
						let FeeNow;
						if(data.gamesPlayed == 0)
						{
							FeeNow = ganginfor.FeeStart;
						}
						else
						{
							FeeNow = ganginfor.FeeStart + (ganginfor.FeeGame * data.gamesPlayed);
						}

						const playerlist = document.createElement("li");
						playerlist.classList.add("list-group-item");
						playerlist.innerHTML = `
						<div class="row">
							<div class="col-8" id="playerCanClick${playerId}" >
								<input type="checkbox" id="playerChecked${playerId}" />
								<i class="fa-regular fa-circle-user"></i> <span style="font-size:20px;">${data.name} </span>
								<br> 
								<span style="font-size: 13px;">เกมที่เล่น: <b class="totalgame">${data.gamesPlayed}</b> ค่าบริการ: <b class="feenow">${FeeNow}</b> บาท </span>
							</div>
							<div class="col-4 d-flex justify-content-end" id="menuList${playerId}"></div>
						</div>
						`;
						playerlist.setAttribute("data-id", playerId);
						playerlist.setAttribute("menu-id", playerId);
						list.appendChild(playerlist);

					//=================================================

						const menu = document.getElementById(`menuList${playerId}`);

						menu.innerHTML = "";
						const menuitem = document.createElement("div");
						menuitem.innerHTML = `
						<!--a href="#" id="edit${playerId}">Edit</a-->
						<a class="btn btn-outline-primary btn-sm" href="#" id="pay${playerId}"><i class="fa-solid fa-money-bill-1-wave"></i> ชำระเงิน</a>
						`;
						menuitem.setAttribute("data-id", playerId);
						menuitem.setAttribute("menu-id", playerId);
						menu.appendChild(menuitem);
						$(`#playerCanClick${playerId}`).click( async (e) => {
							playerlist.classList.add("selected");
							await selectPlayer(playerId, data.name);
						});
						$(`#pay${playerId}`).click( async (e) => {
							await render_qr(`${FeeNow}`);
							$("#staticBackdrop").modal("show");
						});

					});
				} else {
					console.log("ไม่พบข้อมูล");
				}
			}).catch((error) => {
				console.error("เกิดข้อผิดพลาด:", error);
			});

		}
		

		let selectedPlayers = [];

		// เลือกผู้เล่นเพื่อสร้างเกม (2vs2)
		async function selectPlayer(playerId, playerName) {

			if (selectedPlayers.length < 4 && !selectedPlayers.some(p => p.id === playerId)) {

				selectedPlayers.push({ id: playerId, name: playerName });
			}
			if (selectedPlayers.length === 4) {
				await createGame();
			}
		}

		async function loadpage(){

			const date = await getCurrentDate();

			const mathnowtoday 	= document.getElementById("mathnow");
			const mathnow1		= document.getElementById("mathnow1");
			const mathnow2		= document.getElementById("mathnow2");
			const mathnow3		= document.getElementById("mathnow3");
			const mathnow4		= document.getElementById("mathnow4");
			const mathnow5		= document.getElementById("mathnow5");
			const mathnow6		= document.getElementById("mathnow6");

			
			const gamesCountRef = await ref(db, `${gang}/${date}/games/`);
			const gamesno = await get(gamesCountRef).then((snapshot) => {
				return (snapshot.size || 0);
			});

			mathnowtoday.innerHTML = `${gamesno}`


			const game1Ref 		= await ref(db, `${gang}/${date}/games/${gamesno}`);
			const game2Ref 		= await ref(db, `${gang}/${date}/games/${gamesno-1}`);
			const game3Ref 		= await ref(db, `${gang}/${date}/games/${gamesno-2}`);
			const game4Ref 		= await ref(db, `${gang}/${date}/games/${gamesno-3}`);
			const game5Ref 		= await ref(db, `${gang}/${date}/games/${gamesno-4}`);
			const game6Ref 		= await ref(db, `${gang}/${date}/games/${gamesno-5}`);

			const game1Get 		= await get(game1Ref);
			const game2Get 		= await get(game2Ref);
			const game3Get 		= await get(game3Ref);
			const game4Get 		= await get(game4Ref);
			const game5Get 		= await get(game5Ref);
			const game6Get 		= await get(game6Ref);

			const game1infor = game1Get.val();
			const game2infor = game2Get.val();
			const game3infor = game3Get.val();
			const game4infor = game4Get.val();
			const game5infor = game5Get.val();
			const game6infor = game6Get.val();

			// console.log(game1infor);

			if(game1infor !== null){
				mathnow1.innerHTML = `
					<span class="text-dark" style="font-size:20px;">${game1infor.gameno}</span>
					<span style="font-size:15px" class="text-primary">${game1infor.team1_player1}</span>
					<span style="font-size:15px" class="text-primary">${game1infor.team1_player2}</span>
					 VS 
					<span style="font-size:15px" class="text-danger">${game1infor.team2_player1}</span> 
					<span style="font-size:15px" class="text-danger">${game1infor.team2_player2}</span>`
			}

			if(game2infor !== null){
				mathnow2.innerHTML = `
				<span style="font-size:15px" class="text-primary">${game2infor.team1_player1}</span>
				<span style="font-size:15px" class="text-primary">${game2infor.team1_player2}</span>
				 VS 
				<span style="font-size:15px" class="text-danger">${game2infor.team2_player1}</span>
				<span style="font-size:15px" class="text-danger">${game2infor.team2_player2}</span>
				<span class="text-dark" style="font-size:20px;">${game2infor.gameno}</span>
					`
			}

			if(game3infor !== null){
				mathnow3.innerHTML = `
					<span class="text-dark" style="font-size:20px;">${game3infor.gameno}</span>
					<span style="font-size:15px" class="text-primary">${game3infor.team1_player1}</span>
					<span style="font-size:15px" class="text-primary">${game3infor.team1_player2}</span>
					 VS 
					<span style="font-size:15px" class="text-danger">${game3infor.team2_player1}</span>
					<span style="font-size:15px" class="text-danger">${game3infor.team2_player2}</span>`
			}

			if(game4infor !== null){
				mathnow4.innerHTML = `
				<span style="font-size:15px" class="text-primary">${game4infor.team1_player1}</span>
				<span style="font-size:15px" class="text-primary">${game4infor.team1_player2}</span>
				 VS 
				<span style="font-size:15px" class="text-danger">${game4infor.team2_player1}</span>
				<span style="font-size:15px" class="text-danger">${game4infor.team2_player2}</span>
				<span class="text-dark" style="font-size:20px;">${game4infor.gameno}</span>
					`
			}

			if(game5infor !== null){
				mathnow5.innerHTML = `
					<span class="text-dark" style="font-size:20px;">${game5infor.gameno}</span>
					<span style="font-size:15px" class="text-primary">${game5infor.team1_player1}</span>
					<span style="font-size:15px" class="text-primary">${game5infor.team1_player2}</span>
					 VS 
					<span style="font-size:15px" class="text-danger">${game5infor.team2_player1}</span>
					<span style="font-size:15px" class="text-danger">${game5infor.team2_player2}</span>
				`
			}

			if(game6infor !== null){
				mathnow6.innerHTML = `
				<span style="font-size:15px" class="text-primary">${game6infor.team1_player1}</span>
				<span style="font-size:15px" class="text-primary">${game6infor.team1_player2}</span>
				 VS 
				<span style="font-size:15px" class="text-danger">${game6infor.team2_player1}</span>
				<span style="font-size:15px" class="text-danger">${game6infor.team2_player2}</span>
				<span class="text-dark" style="font-size:20px;">${game6infor.gameno}</span>
					`
			}


			// const mathnowtodays	= document.getElementById("mathnow");
			// const gamesCounts 	= await ref(db, `${gang}/${date}/games/`);
			// const gamesnos		= await get(gamesCounts).then((snapshot) => {
			// 	return (snapshot.size || 0);
			// });

			// mathnowtodays.innerHTML = `${gamesnos}`

		}

		// สร้างเกมใหม่ (2vs2)
		async function createGame() {
			if (selectedPlayers.length !== 4) return;

			const date = await getCurrentDate();

			const gamesRef = await ref(db, `${gang}/${date}/games/`);
			const gameno = await get(gamesRef).then((snapshot) => {
				return (snapshot.size || 0) + 1;
			});

			const ccgamesRef = await ref(db, `${gang}/${date}/games/${gameno}`);

			await set(ccgamesRef, {
				gameno: gameno,
				team1_player1: selectedPlayers[0].name,
				team1_player2: selectedPlayers[1].name,
				team2_player1: selectedPlayers[2].name,
				team2_player2: selectedPlayers[3].name,

				team1_id1: selectedPlayers[0].id,
				team1_id2: selectedPlayers[1].id,
				team2_id1: selectedPlayers[2].id,
				team2_id2: selectedPlayers[3].id,
				timestamp: new Date().toISOString()
			});

			// อัปเดตค่าบริการผู้เล่น
			for (const player of selectedPlayers) {
				const playerRef = ref(db, `${gang}/${date}/players/${player.id}`);
				const snapshot = await get(playerRef);
				if (snapshot.exists()) {
					const data = snapshot.val();
					const newGamesPlayed = data.gamesPlayed + 1;
					const newTotalFee = FeeStart + (newGamesPlayed * FeeGame);
					await update(playerRef, { gamesPlayed: newGamesPlayed, totalFee: newTotalFee });
				}
			}
			selectedPlayers = [];


			await loadpage();


		}

		// โหลดข้อมูลเกมตามวันที่
		//async function loadGames(date = getCurrentDate()) {
		async function loadGames() {
			const date = await getCurrentDate();
			const gameList = document.getElementById("gameList");
			gameList.innerHTML = "";

			const gamesRef = ref(db, `${gang}/${date}/games`);
			onValue(gamesRef, async (snapshot) => {

				gameList.innerHTML = `
					<li class="list-group-item">
					<div class="row">
							<div class="col-2 d-flex justify-content-left align-items-center" style="font-size:14px;">เวลา</div>
							<div class="col-1 d-flex justify-content-left align-items-center" style="font-size:15px;">#</div>
							<div class="col-9">
								<div class="row">
									<div class="col-6 d-flex justify-content-end align-items-center">ทีม 1</div>
									<div class="col-6 d-flex justify-content-left align-items-center">ทีม 2</div>
								</div>
							</div>
						</div>
					</li>
				`;
				snapshot.forEach((childSnapshot) => {
					const data = childSnapshot.val();
					// console.log(data);
					const li = document.createElement("li");
					li.classList.add("list-group-item");
					li.innerHTML = `
						<div class="row">
							<div class="col-2 d-flex justify-content-left align-items-center" style="font-size:14px;">${dateymdhis(data.timestamp)}</div>
							<div class="col-1 d-flex justify-content-left align-items-center" style="font-size:15px;">${data.gameno}</div>
							<div class="col-9">
								<div class="row">
									<div class="col-6 d-flex justify-content-end align-items-center">${data.team1_player1} ${data.team1_player2}</div>
									<div class="col-6 d-flex justify-content-left align-items-center">${data.team2_player1} ${data.team2_player2}</div>
								</div>
							</div>
						</div>
					`;
					gameList.appendChild(li);
				});
			});
		}

		// โหลดรายงานย้อนหลัง
		//async function loadReport(date = getCurrentDate()) {
		async function loadReport() {

			const date = await getCurrentDate();
			const reportList = document.getElementById("reportList");

			reportList.innerHTML = "";

			const gamesRef = ref(db, `${gang}`);
			onValue(gamesRef, (snapshot) => {
				reportList.innerHTML = "";
				snapshot.forEach((childSnapshot) => {
					const k = childSnapshot.key;
					const data = childSnapshot.val();

					// console.log(data.timestamp)

					const li = document.createElement("li");
					li.innerHTML = `<b>วันที่: ${date}</b> <button onclick="loadGames('${k}')">ดูรายละเอียด</button>`;
					reportList.appendChild(li);
				});
			});
		}

		// โหลดข้อมูลเมื่อเปิดหน้าเว็บ
		window.onload = async () => {
			await setupGang();
			await loadPlayers();
			await loadpage();
			await loadGames();
			// await loadReport();
		};

		// ทำให้ฟังก์ชันใช้งานได้ใน HTML
		window.addPlayer = addPlayer;
		window.loadPlayers = loadPlayers;
		window.loadpage = loadpage;
		window.searchplayer = searchplayer;

	</script>

</body>
</html>
